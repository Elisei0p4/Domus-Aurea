{% extends 'base.html' %}
{% load static %}

{% block title %}{% if category %}{{ category.name }}{% else %}Магазин{% endif %}{% endblock %}

{% block content %}
<div class="container mx-auto px-4" x-data="catalogFilter()">
    <!-- Хлебные крошки -->
    <nav class="text-sm mb-6" aria-label="Breadcrumb">
        <ol class="list-none p-0 inline-flex items-center">
            <li class="flex items-center">
                <a href="{% url 'store:home' %}" class="text-secondary hover:text-lavender-dark" title="Главная">
                    <i class="fas fa-home"></i>
                </a>
                <i class="fas fa-angle-right mx-2 text-gray-400"></i>
            </li>
            <li class="flex items-center"><a href="{% url 'store:product_list' %}" class="text-secondary hover:text-lavender-dark">Каталог</a></li>
            {% if category %}<li class="flex items-center"><i class="fas fa-angle-right mx-2 text-gray-400"></i><span class="text-text-primary">{{ category.name }}</span></li>{% endif %}
        </ol>
    </nav>
    
    <div class="mb-8">
        <h1 class="text-4xl font-bold" style="color: var(--lavender-deep);">{% if category %}{{ category.name }}{% else %}Все товары{% endif %}</h1>
        {% if category.description %}<p class="mt-2 text-secondary">{{ category.description }}</p>{% endif %}
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-4 gap-8 items-start">
        
        <aside class="lg:col-span-1 lg:sticky lg:top-28">
            <div class="bg-white p-6 rounded-2xl shadow-lg">
                <form method="get">
                    <h3 class="text-xl font-bold mb-6">Фильтры</h3>
                    
                    <div class="space-y-6">
                        <!-- Фильтр по цене -->
                        <div>
                            <label class="font-semibold text-gray-700 block mb-2">Цена</label>
                            <div class="flex justify-between items-center text-sm gap-2">
                                {{ filter.form.min_price }}
                                <span class="text-gray-400">-</span>
                                {{ filter.form.max_price }}
                            </div>
                        </div>

                        <!-- Фильтр по бренду -->
                        {% if filter.form.brand.field.choices|length > 1 %}
                        <div>
                            <label for="{{ filter.form.brand.id_for_label }}" class="font-semibold text-gray-700 block mb-2">{{ filter.form.brand.label }}</label>
                            {{ filter.form.brand }}
                        </div>
                        {% endif %}
                        
                        <!-- Сортировка -->
                        <div>
                            <label for="{{ filter.form.ordering.id_for_label }}" class="font-semibold text-gray-700 block mb-2">{{ filter.form.ordering.label }}</label>
                            {{ filter.form.ordering }}
                        </div>
                    </div>

                    <div class="mt-8 space-y-2">
                        <button type="submit" class="w-full btn-primary px-6 py-2.5">Подобрать</button>
                        <a href="{% if category %}{{ category.get_absolute_url }}{% else %}{% url 'store:product_list' %}{% endif %}" class="w-full block text-center btn-secondary px-6 py-2.5">Сбросить</a>
                    </div>
                </form>
            </div>
        </aside>

        <div class="lg:col-span-3 relative min-h-[500px]">
            <!-- Индикатор загрузки -->
            <div x-show="isLoading" x-transition class="absolute inset-0 bg-white/70 flex items-center justify-center z-10 rounded-2xl">
                <i class="fas fa-spinner fa-spin text-4xl text-lavender-dark"></i>
            </div>
            
            <div id="shop-content-wrapper">
                {% include 'store/partials/shop_content.html' %}
            </div>
        </div>
    </div>
</div>
{% endblock %}